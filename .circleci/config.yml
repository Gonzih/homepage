version: 2
jobs:
  build:
    branches:
      only:
        - source
    docker:
      - image: nixos/nix
    steps:
      - checkout
      - run: nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixos
      - run: nix-channel --update
      - run: nix-env -i gnumake docker git
      - run: rm -rf public || exit 0
      - run: git clone -b gh-pages https://$GITHUB_TOKEN@github.com/Gonzih/homepage.git public
      - run: make generate-using-docker
      - run: git config --global user.name "Deployment Bot (from Circle CI)"
      - run: git config --global user.email "deploy@circleci.com"
      - run: make deploy
